<!doctype html>
<html lang="en">
	<head>
		<title>Wiggle Text</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
  		<link rel="icon" type="image/x-icon" href="logo.gif">
		<!-- Bootstrap -->
	    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
	    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
	    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

	    <!-- JQuery -->
	    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>


		<style>
			canvas {
				width: 100%;
				border: 1px solid black;
				background-color: white;
			}
			textarea {
				width: 100%;
				resize: none !important;
			}
			.btn-light {
				border: 1px solid black !important;
			}
		</style>
		<script src="wiggle.js"></script>		

	</head>
	<body>
		<div class="container-fluid">
			<div class="row">
				<div class="col-md-12 text-center py-3">
					<h1>Wiggle Text</h1>
				</div>
			</div>
			<div class="row">
				<div class="col-md-4 text-center">
					<textarea id="textbox" rows="20">Aa Bb Cc Dd Ee Ff Gg Hh Ii Jj Kk Ll Mm Nn Oo Pp Qq Rr Ss Tt Uu Vv Ww Xx Yy Zz
1 2 3 4 5 6 7 8 9 0
! @ # $ % ^ & * ( )
[ ] { } - _ = + : ; ' " ,
. ? / \ | < > ~ `</textarea>
					<button class="mt-3 btn btn-primary btn-lg" onclick="update()">Render</button>
					<br>
					<div class="input-group my-3">
					  <span class="input-group-text">Size</span>
					  <input id="size-input" type="number" class="form-control" placeholder="65" value="65">
					</div>
					<div class="input-group my-3">
					  <span class="input-group-text">Wiggle</span>
					  <input id="pert-input" type="number" class="form-control" placeholder="0.3" value="0.3">
					</div>
					<div class="input-group my-3">
					  <span class="input-group-text">Thickness</span>
					  <input id="thickness-input" type="number" class="form-control" placeholder="2" value="2">
					</div>
					<div class="input-group my-3">
					  <span class="input-group-text">Spacing</span>
					  <input id="spacing-input" type="number" class="form-control" placeholder="10" value="10">
					</div>
					<div class="input-group my-3">
					  <span class="input-group-text">Linespace</span>
					  <input id="linespace-input" type="number" class="form-control" placeholder="50" value="50">
					</div>
					<div class="input-group my-3">
					  <span class="input-group-text">Page Width</span>
					  <input id="width-input" type="number" class="form-control" placeholder="1000" value="1000">
					</div>
					<div class="input-group my-3">
					  <span class="input-group-text">Margin</span>
					  <input id="margin-input" type="number" class="form-control" placeholder="30" value="30">
					</div>
					<!-- <div class="input-group my-3">
					  <span class="input-group-text">Justification</span>
					  <input id="justification-input" type="text" class="form-control" placeholder="left" value="left">
					</div> -->

					<div class="btn-group" role="group">
						<input type="radio" class="btn-check" name="just" id="just-left" autocomplete="off" value="left" checked>
						<label class="btn btn-light btn-lg" for="just-left">
							<i class="bi bi-text-left"></i>
						</label>

						<input type="radio" class="btn-check" name="just" id="just-center" autocomplete="off" value="center">
						<label class="btn btn-light btn-lg" for="just-center">
							<i class="bi bi-text-center"></i>
						</label>

						<input type="radio" class="btn-check" name="just" id="just-right" autocomplete="off" value="right">
						<label class="btn btn-light btn-lg" for="just-right">
							<i class="bi bi-text-right"></i>
						</label>
					</div>

				</div>

				<div class="col-md-8 text-center">
					<canvas id="canvas" width="1000" height="1000">
						Your Browser doesn't support canvas... sowwyyy..
					</canvas>
					<button class="mt-3 btn btn-primary btn-lg" onclick="download()">Download</button>

				</div>
			</div>
		</div>

		
		
	</body>
	<script>

		let canvas = document.getElementById('canvas');

		var thickness, pert, spacing, linespace, size, justification, page_width, margin;

		var dots = false;


		function update() {

			pert = Number(document.getElementById('pert-input').value) || 0.3;
			thickness = Number(document.getElementById('thickness-input').value) || 2;
			spacing = Number(document.getElementById('spacing-input').value) || 10;
			linespace = Number(document.getElementById('linespace-input').value) || 50;
			size = Number(document.getElementById('size-input').value) || 65;
			margin = Number(document.getElementById('margin-input').value) || 30;
			justification = document.querySelector('input[name="just"]:checked').value || "left";
			page_width = Number(document.getElementById('width-input').value) || 1000;


			canvas.width = page_width;


			let text = document.getElementById('textbox').value;
			let print_lines = [];
			for (let par of text.split("\n")) {
				let line = [];
				let cursor = margin;
				for (let word of par.split(" ")) {
					let word_width = get_word_width(word, size, spacing);
					if (cursor + word_width + margin < canvas.width || line.length == 0) {
						line.push(word);
						cursor += word_width + size/2 + spacing;
					} else {
						cursor = margin + word_width + size/2;
						print_lines.push(JSON.parse(JSON.stringify(line)));
						line = [word];
					}
				}
				print_lines.push(JSON.parse(JSON.stringify(line)));
			}

			canvas.height = Math.max(print_lines.length, 1) * (size + linespace) + margin * 2;
			ctx = canvas.getContext('2d');
			ctx.lineWidth = thickness;

			ctx.fillStyle = "white";
			ctx.fillRect(0, 0, canvas.width, canvas.height);


			let v = margin;
			for (line of print_lines) {
				draw_textline(ctx, line.join(" "), [0, v], size, spacing, dots, pert, justification, margin);
				v += linespace + size;
			}
		}

		update();

		// function test() {
		// 	// let path = bezier([[0,0], [400, 0], [400, 400]]);
		// 	// plot_point_path(get_points(path));
		// 	draw_textline('A BCDEFGHIJKLM', [spacing, spacing], size);
		// 	draw_textline('NOPQRSTUVWXYZ', [spacing, spacing + size + linespace], size);
		// 	draw_textline('abcdefghijklmn', [spacing, spacing + (size + linespace) * 2], size);
		// 	draw_textline('nopqrstuvwxyz', [spacing, spacing + (size + linespace) * 3], size);
		// 	draw_textline('1234567890', [spacing, spacing + (size + linespace) * 4], size);
		// 	draw_textline('!@#$%^&*()', [spacing, spacing + (size + linespace) * 5], size);
		// 	draw_textline('-_+=[]{}/\\?.<>', [spacing, spacing + (size + linespace) * 6], size);
		// 	draw_textline(',:;\'\"', [spacing, spacing + (size + linespace) * 7], size);

		// }

		// test();


		function download() {
			var link = document.createElement('a');
		    link.download = 'wiggle-text.png';
		    link.href = canvas.toDataURL();
		    link.click();
		}



	</script>

</html>